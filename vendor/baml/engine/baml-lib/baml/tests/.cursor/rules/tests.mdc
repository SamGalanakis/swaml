---
alwaysApply: true
---
## How to run

NOTE: The baml_vis children collapse config will effect these tests and can prevent them from passing

- Run the Mermaid headers tests (concise PASS/FAIL/SKIP output):
  - `cargo test --test mermaid_graph_tests -p baml-lib -- --nocapture`
- Update snapshots (write .mmd next to .baml):
  - `UPDATE=1 cargo test --test mermaid_graph_tests -p baml-lib -- --nocapture`
- Create a full mermaid ast + output debug ast of baml file:
  - `cargo run --example mermaid_debug_example baml/tests/validation_files/headers/complex_workflow.baml`
- Create a full mermaid ast with human readable formatting:
  - `cargo run --example mermaid_debug_example -- --fancy baml/tests/validation_files/headers/complex_workflow.baml`

## Test structure

- Fixture directory: `engine/baml-lib/baml/tests/validation_files/headers/`
- Each fixture has:
  - `.baml` input
  - `.mmd` expected output (Mermaid flowchart)
- The test `tests/mermaid_graph_tests.rs`:
  - Parses each `.baml` to `Ast`
  - Renders with `BamlVisDiagramGenerator::generate_headers_flowchart`
  - Compares to sibling `.mmd` (line-ending-insensitive, outputs real newlines in diffs)
  - Prints one line per file: `PASS |`, `FAIL |`, `UPDATED |`, or `SKIP(panic/parse/expect) |`
  - End-of-run summary block with totals

## Authoring fixtures

- If a case is not currently supported, prefix the fixture with `_skip_` or include `invalid` in the name

## Debugging

- If a mismatch occurs, the failure line shows the file. The diff is printed inline.
- You can open Mermaid with any Mermaid viewer; diagrams are standard `flowchart LR`

## Maintenance

- Keep fixtures minimal to reduce churn

