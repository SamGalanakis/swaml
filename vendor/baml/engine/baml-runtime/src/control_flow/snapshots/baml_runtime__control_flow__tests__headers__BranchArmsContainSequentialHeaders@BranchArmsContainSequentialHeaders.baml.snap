---
source: baml-runtime/src/control_flow/tests.rs
expression: snapshot_value
input_file: baml-runtime/src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
---
hir: "Some(\n    Block {\n        statements: [\n            HeaderContextEnter(\n                HeaderContext {\n                    level: 1,\n                    title: \"Before\",\n                    span: Span {\n                        file: SourceFile { path: \"src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml\", contents: ... },\n                        start: 59,\n                        end: 69,\n                    },\n                },\n            ),\n            DeclareAndAssign {\n                name: \"k\",\n                value: NumericValue(\n                    \"0\",\n                    Span {\n                        file: SourceFile { path: \"src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml\", contents: ... },\n                        start: 82,\n                        end: 83,\n                    },\n                ),\n                annotated_type: None,\n                watch: None,\n                span: Span {\n                    file: SourceFile { path: \"src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml\", contents: ... },\n                    start: 74,\n                    end: 85,\n                },\n            },\n            DeclareAndAssign {\n                name: \"value\",\n                value: If {\n                    condition: BinaryOperation {\n                        left: Identifier(\n                            \"k\",\n                            Span {\n                                file: SourceFile { path: \"src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml\", contents: ... },\n                                start: 105,\n                                end: 106,\n                            },\n                        ),\n                        operator: Eq,\n                        right: NumericValue(\n                            \"1\",\n                            Span {\n                                file: SourceFile { path: \"src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml\", contents: ... },\n                                start: 110,\n                                end: 111,\n                            },\n                        ),\n                        span: Span {\n                            file: SourceFile { path: \"src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml\", contents: ... },\n                            start: 105,\n                            end: 111,\n                        },\n                    },\n                    if_branch: Block(\n                        Block {\n                            statements: [\n                                HeaderContextEnter(\n                                    HeaderContext {\n                                        level: 1,\n                                        title: \"k == 1 BranchArm first\",\n                                        span: Span {\n                                            file: SourceFile { path: \"src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml\", contents: ... },\n                                            start: 123,\n                                            end: 149,\n                                        },\n                                    },\n                                ),\n                                HeaderContextEnter(\n                                    HeaderContext {\n                                        level: 1,\n                                        title: \"k == 1 BranchArm second\",\n                                        span: Span {\n                                            file: SourceFile { path: \"src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml\", contents: ... },\n                                            start: 150,\n                                            end: 185,\n                                        },\n                                    },\n                                ),\n                            ],\n                            trailing_expr: Some(\n                                NumericValue(\n                                    \"1\",\n                                    Span {\n                                        file: SourceFile { path: \"src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml\", contents: ... },\n                                        start: 194,\n                                        end: 195,\n                                    },\n                                ),\n                            ),\n                        },\n                        Span {\n                            file: SourceFile { path: \"src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml\", contents: ... },\n                            start: 113,\n                            end: 201,\n                        },\n                    ),\n                    else_branch: Some(\n                        If {\n                            condition: BinaryOperation {\n                                left: Identifier(\n                                    \"k\",\n                                    Span {\n                                        file: SourceFile { path: \"src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml\", contents: ... },\n                                        start: 211,\n                                        end: 212,\n                                    },\n                                ),\n                                operator: Eq,\n                                right: NumericValue(\n                                    \"2\",\n                                    Span {\n                                        file: SourceFile { path: \"src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml\", contents: ... },\n                                        start: 216,\n                                        end: 217,\n                                    },\n                                ),\n                                span: Span {\n                                    file: SourceFile { path: \"src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml\", contents: ... },\n                                    start: 211,\n                                    end: 217,\n                                },\n                            },\n                            if_branch: Block(\n                                Block {\n                                    statements: [\n                                        HeaderContextEnter(\n                                            HeaderContext {\n                                                level: 1,\n                                                title: \"k == 2 BranchArm first\",\n                                                span: Span {\n                                                    file: SourceFile { path: \"src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml\", contents: ... },\n                                                    start: 229,\n                                                    end: 257,\n                                                },\n                                            },\n                                        ),\n                                        HeaderContextEnter(\n                                            HeaderContext {\n                                                level: 1,\n                                                title: \"k == 2 BranchArm second\",\n                                                span: Span {\n                                                    file: SourceFile { path: \"src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml\", contents: ... },\n                                                    start: 258,\n                                                    end: 295,\n                                                },\n                                            },\n                                        ),\n                                        HeaderContextEnter(\n                                            HeaderContext {\n                                                level: 1,\n                                                title: \"k == 2 BranchArm third\",\n                                                span: Span {\n                                                    file: SourceFile { path: \"src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml\", contents: ... },\n                                                    start: 296,\n                                                    end: 333,\n                                                },\n                                            },\n                                        ),\n                                    ],\n                                    trailing_expr: Some(\n                                        NumericValue(\n                                            \"2\",\n                                            Span {\n                                                file: SourceFile { path: \"src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml\", contents: ... },\n                                                start: 342,\n                                                end: 343,\n                                            },\n                                        ),\n                                    ),\n                                },\n                                Span {\n                                    file: SourceFile { path: \"src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml\", contents: ... },\n                                    start: 219,\n                                    end: 349,\n                                },\n                            ),\n                            else_branch: Some(\n                                If {\n                                    condition: BinaryOperation {\n                                        left: Identifier(\n                                            \"k\",\n                                            Span {\n                                                file: SourceFile { path: \"src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml\", contents: ... },\n                                                start: 359,\n                                                end: 360,\n                                            },\n                                        ),\n                                        operator: Eq,\n                                        right: NumericValue(\n                                            \"3\",\n                                            Span {\n                                                file: SourceFile { path: \"src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml\", contents: ... },\n                                                start: 364,\n                                                end: 365,\n                                            },\n                                        ),\n                                        span: Span {\n                                            file: SourceFile { path: \"src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml\", contents: ... },\n                                            start: 359,\n                                            end: 365,\n                                        },\n                                    },\n                                    if_branch: Block(\n                                        Block {\n                                            statements: [],\n                                            trailing_expr: Some(\n                                                NumericValue(\n                                                    \"2\",\n                                                    Span {\n                                                        file: SourceFile { path: \"src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml\", contents: ... },\n                                                        start: 377,\n                                                        end: 378,\n                                                    },\n                                                ),\n                                            ),\n                                        },\n                                        Span {\n                                            file: SourceFile { path: \"src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml\", contents: ... },\n                                            start: 367,\n                                            end: 384,\n                                        },\n                                    ),\n                                    else_branch: Some(\n                                        Block(\n                                            Block {\n                                                statements: [\n                                                    HeaderContextEnter(\n                                                        HeaderContext {\n                                                            level: 1,\n                                                            title: \"Else Branch second\",\n                                                            span: Span {\n                                                                file: SourceFile { path: \"src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml\", contents: ... },\n                                                                start: 400,\n                                                                end: 423,\n                                                            },\n                                                        },\n                                                    ),\n                                                ],\n                                                trailing_expr: Some(\n                                                    NumericValue(\n                                                        \"3\",\n                                                        Span {\n                                                            file: SourceFile { path: \"src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml\", contents: ... },\n                                                            start: 432,\n                                                            end: 433,\n                                                        },\n                                                    ),\n                                                ),\n                                            },\n                                            Span {\n                                                file: SourceFile { path: \"src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml\", contents: ... },\n                                                start: 390,\n                                                end: 439,\n                                            },\n                                        ),\n                                    ),\n                                    span: Span {\n                                        file: SourceFile { path: \"src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml\", contents: ... },\n                                        start: 355,\n                                        end: 439,\n                                    },\n                                },\n                            ),\n                            span: Span {\n                                file: SourceFile { path: \"src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml\", contents: ... },\n                                start: 207,\n                                end: 439,\n                            },\n                        },\n                    ),\n                    span: Span {\n                        file: SourceFile { path: \"src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml\", contents: ... },\n                        start: 101,\n                        end: 439,\n                    },\n                },\n                annotated_type: None,\n                watch: None,\n                span: Span {\n                    file: SourceFile { path: \"src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml\", contents: ... },\n                    start: 89,\n                    end: 441,\n                },\n            },\n            HeaderContextEnter(\n                HeaderContext {\n                    level: 1,\n                    title: \"After\",\n                    span: Span {\n                        file: SourceFile { path: \"src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml\", contents: ... },\n                        start: 446,\n                        end: 455,\n                    },\n                },\n            ),\n        ],\n        trailing_expr: Some(\n            Identifier(\n                \"value\",\n                Span {\n                    file: SourceFile { path: \"src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml\", contents: ... },\n                    start: 461,\n                    end: 466,\n                },\n            ),\n        ),\n    },\n)"
expr:
  nodes:
    "0":
      label: BranchArmsContainSequentialHeaders
      log_filter_key: "BranchArmsContainSequentialHeaders|root:0"
      node_type: function
      parent: ~
      span:
        file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
        start: 0
        end: 468
    "1":
      label: Before
      log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0"
      node_type: header
      parent: "0"
      span:
        file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
        start: 59
        end: 69
    "10":
      label: else if (k == 3)
      log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0|bg:if-k-1:0|arm:else-if-k-3:2"
      node_type: branch-arm
      parent: "2"
      span:
        file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
        start: 367
        end: 384
    "11":
      label: else
      log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0|bg:if-k-1:0|arm:else:3"
      node_type: branch-arm
      parent: "2"
      span:
        file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
        start: 390
        end: 439
    "12":
      label: Else Branch second
      log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0|bg:if-k-1:0|arm:else:3|hdr:else-branch-second:0"
      node_type: header
      parent: "11"
      span:
        file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
        start: 400
        end: 423
    "13":
      label: After
      log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:after:1"
      node_type: header
      parent: "0"
      span:
        file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
        start: 446
        end: 455
    "2":
      label: if (k == 1)
      log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0|bg:if-k-1:0"
      node_type: branch-group
      parent: "1"
      span:
        file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
        start: 101
        end: 439
    "3":
      label: if (k == 1)
      log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0|bg:if-k-1:0|arm:if-k-1:0"
      node_type: branch-arm
      parent: "2"
      span:
        file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
        start: 113
        end: 201
    "4":
      label: k == 1 BranchArm first
      log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0|bg:if-k-1:0|arm:if-k-1:0|hdr:k-1-brancharm-first:0"
      node_type: header
      parent: "3"
      span:
        file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
        start: 123
        end: 149
    "5":
      label: k == 1 BranchArm second
      log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0|bg:if-k-1:0|arm:if-k-1:0|hdr:k-1-brancharm-second:1"
      node_type: header
      parent: "3"
      span:
        file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
        start: 150
        end: 185
    "6":
      label: else if (k == 2)
      log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0|bg:if-k-1:0|arm:else-if-k-2:1"
      node_type: branch-arm
      parent: "2"
      span:
        file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
        start: 219
        end: 349
    "7":
      label: k == 2 BranchArm first
      log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0|bg:if-k-1:0|arm:else-if-k-2:1|hdr:k-2-brancharm-first:0"
      node_type: header
      parent: "6"
      span:
        file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
        start: 229
        end: 257
    "8":
      label: k == 2 BranchArm second
      log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0|bg:if-k-1:0|arm:else-if-k-2:1|hdr:k-2-brancharm-second:1"
      node_type: header
      parent: "6"
      span:
        file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
        start: 258
        end: 295
    "9":
      label: k == 2 BranchArm third
      log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0|bg:if-k-1:0|arm:else-if-k-2:1|hdr:k-2-brancharm-third:2"
      node_type: header
      parent: "6"
      span:
        file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
        start: 296
        end: 333
  edges:
    "1":
      - "13"
    "4":
      - "5"
    "7":
      - "8"
    "8":
      - "9"
mermaid: "flowchart TD\nsubgraph n0[\"0: BranchArmsContainSequentialHeaders\"]\n  direction TB\n  subgraph n1[\"1: Before\"]\n    direction TB\n    subgraph n2[\"2: BranchGroup: if (k == 1)\"]\n      direction TB\n      subgraph n3[\"3: BranchArm: if (k == 1)\"]\n        direction TB\n        n4[\"4: k == 1 BranchArm first\"]\n        n5[\"5: k == 1 BranchArm second\"]\n        n4 --> n5\n      end\n      subgraph n6[\"6: BranchArm: else if (k == 2)\"]\n        direction TB\n        n7[\"7: k == 2 BranchArm first\"]\n        n8[\"8: k == 2 BranchArm second\"]\n        n9[\"9: k == 2 BranchArm third\"]\n        n7 --> n8\n        n8 --> n9\n      end\n      n10[\"10: BranchArm: else if (k == 3)\"]\n      subgraph n11[\"11: BranchArm: else\"]\n        direction TB\n        n12[\"12: Else Branch second\"]\n      end\n    end\n  end\n  n13[\"13: After\"]\n  n1 --> n13\nend\n"
flattening:
  pass1_remove_implicit:
    label: Remove implicit nodes
    expr:
      nodes:
        "0":
          label: BranchArmsContainSequentialHeaders
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0"
          node_type: function
          parent: ~
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 0
            end: 468
        "1":
          label: Before
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0"
          node_type: header
          parent: "0"
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 59
            end: 69
        "10":
          label: else if (k == 3)
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0|bg:if-k-1:0|arm:else-if-k-3:2"
          node_type: branch-arm
          parent: "2"
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 367
            end: 384
        "11":
          label: else
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0|bg:if-k-1:0|arm:else:3"
          node_type: branch-arm
          parent: "2"
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 390
            end: 439
        "12":
          label: Else Branch second
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0|bg:if-k-1:0|arm:else:3|hdr:else-branch-second:0"
          node_type: header
          parent: "11"
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 400
            end: 423
        "13":
          label: After
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:after:1"
          node_type: header
          parent: "0"
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 446
            end: 455
        "2":
          label: if (k == 1)
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0|bg:if-k-1:0"
          node_type: branch-group
          parent: "1"
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 101
            end: 439
        "3":
          label: if (k == 1)
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0|bg:if-k-1:0|arm:if-k-1:0"
          node_type: branch-arm
          parent: "2"
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 113
            end: 201
        "4":
          label: k == 1 BranchArm first
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0|bg:if-k-1:0|arm:if-k-1:0|hdr:k-1-brancharm-first:0"
          node_type: header
          parent: "3"
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 123
            end: 149
        "5":
          label: k == 1 BranchArm second
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0|bg:if-k-1:0|arm:if-k-1:0|hdr:k-1-brancharm-second:1"
          node_type: header
          parent: "3"
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 150
            end: 185
        "6":
          label: else if (k == 2)
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0|bg:if-k-1:0|arm:else-if-k-2:1"
          node_type: branch-arm
          parent: "2"
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 219
            end: 349
        "7":
          label: k == 2 BranchArm first
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0|bg:if-k-1:0|arm:else-if-k-2:1|hdr:k-2-brancharm-first:0"
          node_type: header
          parent: "6"
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 229
            end: 257
        "8":
          label: k == 2 BranchArm second
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0|bg:if-k-1:0|arm:else-if-k-2:1|hdr:k-2-brancharm-second:1"
          node_type: header
          parent: "6"
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 258
            end: 295
        "9":
          label: k == 2 BranchArm third
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0|bg:if-k-1:0|arm:else-if-k-2:1|hdr:k-2-brancharm-third:2"
          node_type: header
          parent: "6"
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 296
            end: 333
      edges:
        "1":
          - "13"
        "4":
          - "5"
        "7":
          - "8"
        "8":
          - "9"
    json:
      nodes:
        "0":
          label: BranchArmsContainSequentialHeaders
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0"
          node_type: function
          parent: ~
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 0
            end: 468
        "1":
          label: Before
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0"
          node_type: header
          parent: "0"
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 59
            end: 69
        "10":
          label: else if (k == 3)
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0|bg:if-k-1:0|arm:else-if-k-3:2"
          node_type: branch-arm
          parent: "2"
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 367
            end: 384
        "11":
          label: else
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0|bg:if-k-1:0|arm:else:3"
          node_type: branch-arm
          parent: "2"
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 390
            end: 439
        "12":
          label: Else Branch second
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0|bg:if-k-1:0|arm:else:3|hdr:else-branch-second:0"
          node_type: header
          parent: "11"
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 400
            end: 423
        "13":
          label: After
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:after:1"
          node_type: header
          parent: "0"
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 446
            end: 455
        "2":
          label: if (k == 1)
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0|bg:if-k-1:0"
          node_type: branch-group
          parent: "1"
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 101
            end: 439
        "3":
          label: if (k == 1)
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0|bg:if-k-1:0|arm:if-k-1:0"
          node_type: branch-arm
          parent: "2"
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 113
            end: 201
        "4":
          label: k == 1 BranchArm first
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0|bg:if-k-1:0|arm:if-k-1:0|hdr:k-1-brancharm-first:0"
          node_type: header
          parent: "3"
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 123
            end: 149
        "5":
          label: k == 1 BranchArm second
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0|bg:if-k-1:0|arm:if-k-1:0|hdr:k-1-brancharm-second:1"
          node_type: header
          parent: "3"
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 150
            end: 185
        "6":
          label: else if (k == 2)
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0|bg:if-k-1:0|arm:else-if-k-2:1"
          node_type: branch-arm
          parent: "2"
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 219
            end: 349
        "7":
          label: k == 2 BranchArm first
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0|bg:if-k-1:0|arm:else-if-k-2:1|hdr:k-2-brancharm-first:0"
          node_type: header
          parent: "6"
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 229
            end: 257
        "8":
          label: k == 2 BranchArm second
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0|bg:if-k-1:0|arm:else-if-k-2:1|hdr:k-2-brancharm-second:1"
          node_type: header
          parent: "6"
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 258
            end: 295
        "9":
          label: k == 2 BranchArm third
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0|bg:if-k-1:0|arm:else-if-k-2:1|hdr:k-2-brancharm-third:2"
          node_type: header
          parent: "6"
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 296
            end: 333
      edges:
        "1":
          - "13"
        "4":
          - "5"
        "7":
          - "8"
        "8":
          - "9"
    mermaid: "flowchart TD\nsubgraph n0[\"0: BranchArmsContainSequentialHeaders\"]\n  direction TB\n  subgraph n1[\"1: Before\"]\n    direction TB\n    subgraph n2[\"2: BranchGroup: if (k == 1)\"]\n      direction TB\n      subgraph n3[\"3: BranchArm: if (k == 1)\"]\n        direction TB\n        n4[\"4: k == 1 BranchArm first\"]\n        n5[\"5: k == 1 BranchArm second\"]\n        n4 --> n5\n      end\n      subgraph n6[\"6: BranchArm: else if (k == 2)\"]\n        direction TB\n        n7[\"7: k == 2 BranchArm first\"]\n        n8[\"8: k == 2 BranchArm second\"]\n        n9[\"9: k == 2 BranchArm third\"]\n        n7 --> n8\n        n8 --> n9\n      end\n      n10[\"10: BranchArm: else if (k == 3)\"]\n      subgraph n11[\"11: BranchArm: else\"]\n        direction TB\n        n12[\"12: Else Branch second\"]\n      end\n    end\n  end\n  n13[\"13: After\"]\n  n1 --> n13\nend\n"
  pass2_hoist_branch_arms:
    label: Hoist branch arms
    expr:
      nodes:
        "0":
          label: BranchArmsContainSequentialHeaders
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0"
          node_type: function
          parent: ~
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 0
            end: 468
        "1":
          label: Before
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0"
          node_type: header
          parent: "0"
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 59
            end: 69
        "10":
          label: else if (k == 3)
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0|bg:if-k-1:0|arm:else-if-k-3:2"
          node_type: branch-arm
          parent: "1"
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 367
            end: 384
        "11":
          label: else
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0|bg:if-k-1:0|arm:else:3"
          node_type: branch-arm
          parent: "1"
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 390
            end: 439
        "12":
          label: Else Branch second
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0|bg:if-k-1:0|arm:else:3|hdr:else-branch-second:0"
          node_type: header
          parent: "11"
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 400
            end: 423
        "13":
          label: After
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:after:1"
          node_type: header
          parent: "0"
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 446
            end: 455
        "2":
          label: if (k == 1)
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0|bg:if-k-1:0"
          node_type: branch-group
          parent: "1"
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 101
            end: 439
        "3":
          label: if (k == 1)
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0|bg:if-k-1:0|arm:if-k-1:0"
          node_type: branch-arm
          parent: "1"
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 113
            end: 201
        "4":
          label: k == 1 BranchArm first
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0|bg:if-k-1:0|arm:if-k-1:0|hdr:k-1-brancharm-first:0"
          node_type: header
          parent: "3"
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 123
            end: 149
        "5":
          label: k == 1 BranchArm second
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0|bg:if-k-1:0|arm:if-k-1:0|hdr:k-1-brancharm-second:1"
          node_type: header
          parent: "3"
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 150
            end: 185
        "6":
          label: else if (k == 2)
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0|bg:if-k-1:0|arm:else-if-k-2:1"
          node_type: branch-arm
          parent: "1"
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 219
            end: 349
        "7":
          label: k == 2 BranchArm first
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0|bg:if-k-1:0|arm:else-if-k-2:1|hdr:k-2-brancharm-first:0"
          node_type: header
          parent: "6"
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 229
            end: 257
        "8":
          label: k == 2 BranchArm second
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0|bg:if-k-1:0|arm:else-if-k-2:1|hdr:k-2-brancharm-second:1"
          node_type: header
          parent: "6"
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 258
            end: 295
        "9":
          label: k == 2 BranchArm third
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0|bg:if-k-1:0|arm:else-if-k-2:1|hdr:k-2-brancharm-third:2"
          node_type: header
          parent: "6"
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 296
            end: 333
      edges:
        "1":
          - "13"
        "2":
          - "10"
          - "11"
          - "3"
          - "6"
        "4":
          - "5"
        "7":
          - "8"
        "8":
          - "9"
    json:
      nodes:
        "0":
          label: BranchArmsContainSequentialHeaders
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0"
          node_type: function
          parent: ~
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 0
            end: 468
        "1":
          label: Before
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0"
          node_type: header
          parent: "0"
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 59
            end: 69
        "10":
          label: else if (k == 3)
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0|bg:if-k-1:0|arm:else-if-k-3:2"
          node_type: branch-arm
          parent: "1"
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 367
            end: 384
        "11":
          label: else
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0|bg:if-k-1:0|arm:else:3"
          node_type: branch-arm
          parent: "1"
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 390
            end: 439
        "12":
          label: Else Branch second
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0|bg:if-k-1:0|arm:else:3|hdr:else-branch-second:0"
          node_type: header
          parent: "11"
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 400
            end: 423
        "13":
          label: After
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:after:1"
          node_type: header
          parent: "0"
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 446
            end: 455
        "2":
          label: if (k == 1)
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0|bg:if-k-1:0"
          node_type: branch-group
          parent: "1"
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 101
            end: 439
        "3":
          label: if (k == 1)
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0|bg:if-k-1:0|arm:if-k-1:0"
          node_type: branch-arm
          parent: "1"
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 113
            end: 201
        "4":
          label: k == 1 BranchArm first
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0|bg:if-k-1:0|arm:if-k-1:0|hdr:k-1-brancharm-first:0"
          node_type: header
          parent: "3"
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 123
            end: 149
        "5":
          label: k == 1 BranchArm second
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0|bg:if-k-1:0|arm:if-k-1:0|hdr:k-1-brancharm-second:1"
          node_type: header
          parent: "3"
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 150
            end: 185
        "6":
          label: else if (k == 2)
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0|bg:if-k-1:0|arm:else-if-k-2:1"
          node_type: branch-arm
          parent: "1"
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 219
            end: 349
        "7":
          label: k == 2 BranchArm first
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0|bg:if-k-1:0|arm:else-if-k-2:1|hdr:k-2-brancharm-first:0"
          node_type: header
          parent: "6"
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 229
            end: 257
        "8":
          label: k == 2 BranchArm second
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0|bg:if-k-1:0|arm:else-if-k-2:1|hdr:k-2-brancharm-second:1"
          node_type: header
          parent: "6"
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 258
            end: 295
        "9":
          label: k == 2 BranchArm third
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0|bg:if-k-1:0|arm:else-if-k-2:1|hdr:k-2-brancharm-third:2"
          node_type: header
          parent: "6"
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 296
            end: 333
      edges:
        "1":
          - "13"
        "2":
          - "10"
          - "11"
          - "3"
          - "6"
        "4":
          - "5"
        "7":
          - "8"
        "8":
          - "9"
    mermaid: "flowchart TD\nsubgraph n0[\"0: BranchArmsContainSequentialHeaders\"]\n  direction TB\n  subgraph n1[\"1: Before\"]\n    direction TB\n    n2[\"2: BranchGroup: if (k == 1)\"]\n    subgraph n3[\"3: BranchArm: if (k == 1)\"]\n      direction TB\n      n4[\"4: k == 1 BranchArm first\"]\n      n5[\"5: k == 1 BranchArm second\"]\n      n4 --> n5\n    end\n    subgraph n6[\"6: BranchArm: else if (k == 2)\"]\n      direction TB\n      n7[\"7: k == 2 BranchArm first\"]\n      n8[\"8: k == 2 BranchArm second\"]\n      n9[\"9: k == 2 BranchArm third\"]\n      n7 --> n8\n      n8 --> n9\n    end\n    n10[\"10: BranchArm: else if (k == 3)\"]\n    subgraph n11[\"11: BranchArm: else\"]\n      direction TB\n      n12[\"12: Else Branch second\"]\n    end\n    n2 --> n3\n    n2 --> n6\n    n2 --> n10\n    n2 --> n11\n  end\n  n13[\"13: After\"]\n  n1 --> n13\nend\n"
  pass3_flatten_scopes:
    label: Flatten branch arms & scopes
    expr:
      nodes:
        "0":
          label: BranchArmsContainSequentialHeaders
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0"
          node_type: function
          parent: ~
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 0
            end: 468
        "1":
          label: Before
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0"
          node_type: header
          parent: "0"
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 59
            end: 69
        "10":
          label: else if (k == 3)
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0|bg:if-k-1:0|arm:else-if-k-3:2"
          node_type: branch-arm
          parent: "1"
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 367
            end: 384
        "12":
          label: Else Branch second
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0|bg:if-k-1:0|arm:else:3|hdr:else-branch-second:0"
          node_type: header
          parent: "1"
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 400
            end: 423
        "13":
          label: After
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:after:1"
          node_type: header
          parent: "0"
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 446
            end: 455
        "2":
          label: if (k == 1)
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0|bg:if-k-1:0"
          node_type: branch-group
          parent: "1"
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 101
            end: 439
        "4":
          label: k == 1 BranchArm first
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0|bg:if-k-1:0|arm:if-k-1:0|hdr:k-1-brancharm-first:0"
          node_type: header
          parent: "1"
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 123
            end: 149
        "5":
          label: k == 1 BranchArm second
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0|bg:if-k-1:0|arm:if-k-1:0|hdr:k-1-brancharm-second:1"
          node_type: header
          parent: "1"
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 150
            end: 185
        "7":
          label: k == 2 BranchArm first
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0|bg:if-k-1:0|arm:else-if-k-2:1|hdr:k-2-brancharm-first:0"
          node_type: header
          parent: "1"
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 229
            end: 257
        "8":
          label: k == 2 BranchArm second
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0|bg:if-k-1:0|arm:else-if-k-2:1|hdr:k-2-brancharm-second:1"
          node_type: header
          parent: "1"
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 258
            end: 295
        "9":
          label: k == 2 BranchArm third
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0|bg:if-k-1:0|arm:else-if-k-2:1|hdr:k-2-brancharm-third:2"
          node_type: header
          parent: "1"
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 296
            end: 333
      edges:
        "1":
          - "13"
        "2":
          - "10"
          - "12"
          - "4"
          - "7"
        "4":
          - "5"
        "7":
          - "8"
        "8":
          - "9"
    json:
      nodes:
        "0":
          label: BranchArmsContainSequentialHeaders
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0"
          node_type: function
          parent: ~
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 0
            end: 468
        "1":
          label: Before
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0"
          node_type: header
          parent: "0"
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 59
            end: 69
        "10":
          label: else if (k == 3)
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0|bg:if-k-1:0|arm:else-if-k-3:2"
          node_type: branch-arm
          parent: "1"
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 367
            end: 384
        "12":
          label: Else Branch second
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0|bg:if-k-1:0|arm:else:3|hdr:else-branch-second:0"
          node_type: header
          parent: "1"
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 400
            end: 423
        "13":
          label: After
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:after:1"
          node_type: header
          parent: "0"
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 446
            end: 455
        "2":
          label: if (k == 1)
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0|bg:if-k-1:0"
          node_type: branch-group
          parent: "1"
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 101
            end: 439
        "4":
          label: k == 1 BranchArm first
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0|bg:if-k-1:0|arm:if-k-1:0|hdr:k-1-brancharm-first:0"
          node_type: header
          parent: "1"
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 123
            end: 149
        "5":
          label: k == 1 BranchArm second
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0|bg:if-k-1:0|arm:if-k-1:0|hdr:k-1-brancharm-second:1"
          node_type: header
          parent: "1"
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 150
            end: 185
        "7":
          label: k == 2 BranchArm first
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0|bg:if-k-1:0|arm:else-if-k-2:1|hdr:k-2-brancharm-first:0"
          node_type: header
          parent: "1"
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 229
            end: 257
        "8":
          label: k == 2 BranchArm second
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0|bg:if-k-1:0|arm:else-if-k-2:1|hdr:k-2-brancharm-second:1"
          node_type: header
          parent: "1"
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 258
            end: 295
        "9":
          label: k == 2 BranchArm third
          log_filter_key: "BranchArmsContainSequentialHeaders|root:0|hdr:before:0|bg:if-k-1:0|arm:else-if-k-2:1|hdr:k-2-brancharm-third:2"
          node_type: header
          parent: "1"
          span:
            file: src/control_flow/testdata/BranchArmsContainSequentialHeaders.baml
            start: 296
            end: 333
      edges:
        "1":
          - "13"
        "2":
          - "10"
          - "12"
          - "4"
          - "7"
        "4":
          - "5"
        "7":
          - "8"
        "8":
          - "9"
    mermaid: "flowchart TD\nsubgraph n0[\"0: BranchArmsContainSequentialHeaders\"]\n  direction TB\n  subgraph n1[\"1: Before\"]\n    direction TB\n    n2[\"2: BranchGroup: if (k == 1)\"]\n    n3[\"4: k == 1 BranchArm first\"]\n    n4[\"5: k == 1 BranchArm second\"]\n    n5[\"7: k == 2 BranchArm first\"]\n    n6[\"8: k == 2 BranchArm second\"]\n    n7[\"9: k == 2 BranchArm third\"]\n    n8[\"10: BranchArm: else if (k == 3)\"]\n    n9[\"12: Else Branch second\"]\n    n3 --> n4\n    n5 --> n6\n    n6 --> n7\n    n2 --> n3\n    n2 --> n5\n    n2 --> n8\n    n2 --> n9\n  end\n  n10[\"13: After\"]\n  n1 --> n10\nend\n"
