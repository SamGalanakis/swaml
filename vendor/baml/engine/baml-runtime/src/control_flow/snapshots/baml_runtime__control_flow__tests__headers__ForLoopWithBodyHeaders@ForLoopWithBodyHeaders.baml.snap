---
source: baml-runtime/src/control_flow/tests.rs
expression: snapshot_value
input_file: baml-runtime/src/control_flow/testdata/ForLoopWithBodyHeaders.baml
---
hir: "Some(\n    Block {\n        statements: [\n            HeaderContextEnter(\n                HeaderContext {\n                    level: 1,\n                    title: \"Loop Processing\",\n                    span: Span {\n                        file: SourceFile { path: \"src/control_flow/testdata/ForLoopWithBodyHeaders.baml\", contents: ... },\n                        start: 47,\n                        end: 66,\n                    },\n                },\n            ),\n            DeclareAndAssign {\n                name: \"items\",\n                value: Array(\n                    [\n                        NumericValue(\n                            \"1\",\n                            Span {\n                                file: SourceFile { path: \"src/control_flow/testdata/ForLoopWithBodyHeaders.baml\", contents: ... },\n                                start: 84,\n                                end: 85,\n                            },\n                        ),\n                        NumericValue(\n                            \"2\",\n                            Span {\n                                file: SourceFile { path: \"src/control_flow/testdata/ForLoopWithBodyHeaders.baml\", contents: ... },\n                                start: 87,\n                                end: 88,\n                            },\n                        ),\n                        NumericValue(\n                            \"3\",\n                            Span {\n                                file: SourceFile { path: \"src/control_flow/testdata/ForLoopWithBodyHeaders.baml\", contents: ... },\n                                start: 90,\n                                end: 91,\n                            },\n                        ),\n                        NumericValue(\n                            \"4\",\n                            Span {\n                                file: SourceFile { path: \"src/control_flow/testdata/ForLoopWithBodyHeaders.baml\", contents: ... },\n                                start: 93,\n                                end: 94,\n                            },\n                        ),\n                        NumericValue(\n                            \"5\",\n                            Span {\n                                file: SourceFile { path: \"src/control_flow/testdata/ForLoopWithBodyHeaders.baml\", contents: ... },\n                                start: 96,\n                                end: 97,\n                            },\n                        ),\n                    ],\n                    Span {\n                        file: SourceFile { path: \"src/control_flow/testdata/ForLoopWithBodyHeaders.baml\", contents: ... },\n                        start: 83,\n                        end: 98,\n                    },\n                ),\n                annotated_type: None,\n                watch: None,\n                span: Span {\n                    file: SourceFile { path: \"src/control_flow/testdata/ForLoopWithBodyHeaders.baml\", contents: ... },\n                    start: 71,\n                    end: 100,\n                },\n            },\n            DeclareAndAssign {\n                name: \"result\",\n                value: NumericValue(\n                    \"0\",\n                    Span {\n                        file: SourceFile { path: \"src/control_flow/testdata/ForLoopWithBodyHeaders.baml\", contents: ... },\n                        start: 117,\n                        end: 118,\n                    },\n                ),\n                annotated_type: None,\n                watch: None,\n                span: Span {\n                    file: SourceFile { path: \"src/control_flow/testdata/ForLoopWithBodyHeaders.baml\", contents: ... },\n                    start: 104,\n                    end: 120,\n                },\n            },\n            HeaderContextEnter(\n                HeaderContext {\n                    level: 2,\n                    title: \"Main Loop\",\n                    span: Span {\n                        file: SourceFile { path: \"src/control_flow/testdata/ForLoopWithBodyHeaders.baml\", contents: ... },\n                        start: 125,\n                        end: 139,\n                    },\n                },\n            ),\n            ForLoop {\n                identifier: \"item\",\n                iterator: Identifier(\n                    \"items\",\n                    Span {\n                        file: SourceFile { path: \"src/control_flow/testdata/ForLoopWithBodyHeaders.baml\", contents: ... },\n                        start: 161,\n                        end: 166,\n                    },\n                ),\n                block: Block {\n                    statements: [\n                        HeaderContextEnter(\n                            HeaderContext {\n                                level: 1,\n                                title: \"Item Processing\",\n                                span: Span {\n                                    file: SourceFile { path: \"src/control_flow/testdata/ForLoopWithBodyHeaders.baml\", contents: ... },\n                                    start: 178,\n                                    end: 199,\n                                },\n                            },\n                        ),\n                        DeclareAndAssign {\n                            name: \"processed\",\n                            value: BinaryOperation {\n                                left: Identifier(\n                                    \"item\",\n                                    Span {\n                                        file: SourceFile { path: \"src/control_flow/testdata/ForLoopWithBodyHeaders.baml\", contents: ... },\n                                        start: 224,\n                                        end: 228,\n                                    },\n                                ),\n                                operator: Mul,\n                                right: NumericValue(\n                                    \"2\",\n                                    Span {\n                                        file: SourceFile { path: \"src/control_flow/testdata/ForLoopWithBodyHeaders.baml\", contents: ... },\n                                        start: 231,\n                                        end: 232,\n                                    },\n                                ),\n                                span: Span {\n                                    file: SourceFile { path: \"src/control_flow/testdata/ForLoopWithBodyHeaders.baml\", contents: ... },\n                                    start: 224,\n                                    end: 232,\n                                },\n                            },\n                            annotated_type: None,\n                            watch: None,\n                            span: Span {\n                                file: SourceFile { path: \"src/control_flow/testdata/ForLoopWithBodyHeaders.baml\", contents: ... },\n                                start: 208,\n                                end: 234,\n                            },\n                        },\n                        HeaderContextEnter(\n                            HeaderContext {\n                                level: 2,\n                                title: \"Accumulation\",\n                                span: Span {\n                                    file: SourceFile { path: \"src/control_flow/testdata/ForLoopWithBodyHeaders.baml\", contents: ... },\n                                    start: 243,\n                                    end: 262,\n                                },\n                            },\n                        ),\n                        DeclareAndAssign {\n                            name: \"result2\",\n                            value: BinaryOperation {\n                                left: Identifier(\n                                    \"result\",\n                                    Span {\n                                        file: SourceFile { path: \"src/control_flow/testdata/ForLoopWithBodyHeaders.baml\", contents: ... },\n                                        start: 285,\n                                        end: 291,\n                                    },\n                                ),\n                                operator: Add,\n                                right: Identifier(\n                                    \"processed\",\n                                    Span {\n                                        file: SourceFile { path: \"src/control_flow/testdata/ForLoopWithBodyHeaders.baml\", contents: ... },\n                                        start: 294,\n                                        end: 303,\n                                    },\n                                ),\n                                span: Span {\n                                    file: SourceFile { path: \"src/control_flow/testdata/ForLoopWithBodyHeaders.baml\", contents: ... },\n                                    start: 285,\n                                    end: 303,\n                                },\n                            },\n                            annotated_type: None,\n                            watch: None,\n                            span: Span {\n                                file: SourceFile { path: \"src/control_flow/testdata/ForLoopWithBodyHeaders.baml\", contents: ... },\n                                start: 271,\n                                end: 305,\n                            },\n                        },\n                    ],\n                    trailing_expr: Some(\n                        Identifier(\n                            \"result2\",\n                            Span {\n                                file: SourceFile { path: \"src/control_flow/testdata/ForLoopWithBodyHeaders.baml\", contents: ... },\n                                start: 314,\n                                end: 321,\n                            },\n                        ),\n                    ),\n                },\n                span: Span {\n                    file: SourceFile { path: \"src/control_flow/testdata/ForLoopWithBodyHeaders.baml\", contents: ... },\n                    start: 144,\n                    end: 327,\n                },\n            },\n            HeaderContextEnter(\n                HeaderContext {\n                    level: 2,\n                    title: \"Final Result\",\n                    span: Span {\n                        file: SourceFile { path: \"src/control_flow/testdata/ForLoopWithBodyHeaders.baml\", contents: ... },\n                        start: 333,\n                        end: 350,\n                    },\n                },\n            ),\n        ],\n        trailing_expr: Some(\n            Identifier(\n                \"result\",\n                Span {\n                    file: SourceFile { path: \"src/control_flow/testdata/ForLoopWithBodyHeaders.baml\", contents: ... },\n                    start: 355,\n                    end: 361,\n                },\n            ),\n        ),\n    },\n)"
expr:
  nodes:
    "0":
      label: ForLoopWithBodyHeaders
      log_filter_key: "ForLoopWithBodyHeaders|root:0"
      node_type: function
      parent: ~
      span:
        file: src/control_flow/testdata/ForLoopWithBodyHeaders.baml
        start: 0
        end: 363
    "1":
      label: Loop Processing
      log_filter_key: "ForLoopWithBodyHeaders|root:0|hdr:loop-processing:0"
      node_type: header
      parent: "0"
      span:
        file: src/control_flow/testdata/ForLoopWithBodyHeaders.baml
        start: 47
        end: 66
    "2":
      label: Main Loop
      log_filter_key: "ForLoopWithBodyHeaders|root:0|hdr:loop-processing:0|hdr:main-loop:0"
      node_type: header
      parent: "1"
      span:
        file: src/control_flow/testdata/ForLoopWithBodyHeaders.baml
        start: 125
        end: 139
    "3":
      label: for (item in items)
      log_filter_key: "ForLoopWithBodyHeaders|root:0|hdr:loop-processing:0|hdr:main-loop:0|loop:for-item-in-items:0"
      node_type: loop
      parent: "2"
      span:
        file: src/control_flow/testdata/ForLoopWithBodyHeaders.baml
        start: 144
        end: 327
    "4":
      label: Item Processing
      log_filter_key: "ForLoopWithBodyHeaders|root:0|hdr:loop-processing:0|hdr:main-loop:0|loop:for-item-in-items:0|hdr:item-processing:0"
      node_type: header
      parent: "3"
      span:
        file: src/control_flow/testdata/ForLoopWithBodyHeaders.baml
        start: 178
        end: 199
    "5":
      label: Accumulation
      log_filter_key: "ForLoopWithBodyHeaders|root:0|hdr:loop-processing:0|hdr:main-loop:0|loop:for-item-in-items:0|hdr:item-processing:0|hdr:accumulation:0"
      node_type: header
      parent: "4"
      span:
        file: src/control_flow/testdata/ForLoopWithBodyHeaders.baml
        start: 243
        end: 262
    "6":
      label: Final Result
      log_filter_key: "ForLoopWithBodyHeaders|root:0|hdr:loop-processing:0|hdr:final-result:1"
      node_type: header
      parent: "1"
      span:
        file: src/control_flow/testdata/ForLoopWithBodyHeaders.baml
        start: 333
        end: 350
  edges:
    "2":
      - "6"
mermaid: "flowchart TD\nsubgraph n0[\"0: ForLoopWithBodyHeaders\"]\n  direction TB\n  subgraph n1[\"1: Loop Processing\"]\n    direction TB\n    subgraph n2[\"2: Main Loop\"]\n      direction TB\n      subgraph n3[\"3: Loop: for (item in items)\"]\n        direction TB\n        subgraph n4[\"4: Item Processing\"]\n          direction TB\n          n5[\"5: Accumulation\"]\n        end\n      end\n    end\n    n6[\"6: Final Result\"]\n    n2 --> n6\n  end\nend\n"
flattening:
  pass1_remove_implicit:
    label: Remove implicit nodes
    expr:
      nodes:
        "0":
          label: ForLoopWithBodyHeaders
          log_filter_key: "ForLoopWithBodyHeaders|root:0"
          node_type: function
          parent: ~
          span:
            file: src/control_flow/testdata/ForLoopWithBodyHeaders.baml
            start: 0
            end: 363
        "1":
          label: Loop Processing
          log_filter_key: "ForLoopWithBodyHeaders|root:0|hdr:loop-processing:0"
          node_type: header
          parent: "0"
          span:
            file: src/control_flow/testdata/ForLoopWithBodyHeaders.baml
            start: 47
            end: 66
        "2":
          label: Main Loop
          log_filter_key: "ForLoopWithBodyHeaders|root:0|hdr:loop-processing:0|hdr:main-loop:0"
          node_type: header
          parent: "1"
          span:
            file: src/control_flow/testdata/ForLoopWithBodyHeaders.baml
            start: 125
            end: 139
        "3":
          label: for (item in items)
          log_filter_key: "ForLoopWithBodyHeaders|root:0|hdr:loop-processing:0|hdr:main-loop:0|loop:for-item-in-items:0"
          node_type: loop
          parent: "2"
          span:
            file: src/control_flow/testdata/ForLoopWithBodyHeaders.baml
            start: 144
            end: 327
        "4":
          label: Item Processing
          log_filter_key: "ForLoopWithBodyHeaders|root:0|hdr:loop-processing:0|hdr:main-loop:0|loop:for-item-in-items:0|hdr:item-processing:0"
          node_type: header
          parent: "3"
          span:
            file: src/control_flow/testdata/ForLoopWithBodyHeaders.baml
            start: 178
            end: 199
        "5":
          label: Accumulation
          log_filter_key: "ForLoopWithBodyHeaders|root:0|hdr:loop-processing:0|hdr:main-loop:0|loop:for-item-in-items:0|hdr:item-processing:0|hdr:accumulation:0"
          node_type: header
          parent: "4"
          span:
            file: src/control_flow/testdata/ForLoopWithBodyHeaders.baml
            start: 243
            end: 262
        "6":
          label: Final Result
          log_filter_key: "ForLoopWithBodyHeaders|root:0|hdr:loop-processing:0|hdr:final-result:1"
          node_type: header
          parent: "1"
          span:
            file: src/control_flow/testdata/ForLoopWithBodyHeaders.baml
            start: 333
            end: 350
      edges:
        "2":
          - "6"
    json:
      nodes:
        "0":
          label: ForLoopWithBodyHeaders
          log_filter_key: "ForLoopWithBodyHeaders|root:0"
          node_type: function
          parent: ~
          span:
            file: src/control_flow/testdata/ForLoopWithBodyHeaders.baml
            start: 0
            end: 363
        "1":
          label: Loop Processing
          log_filter_key: "ForLoopWithBodyHeaders|root:0|hdr:loop-processing:0"
          node_type: header
          parent: "0"
          span:
            file: src/control_flow/testdata/ForLoopWithBodyHeaders.baml
            start: 47
            end: 66
        "2":
          label: Main Loop
          log_filter_key: "ForLoopWithBodyHeaders|root:0|hdr:loop-processing:0|hdr:main-loop:0"
          node_type: header
          parent: "1"
          span:
            file: src/control_flow/testdata/ForLoopWithBodyHeaders.baml
            start: 125
            end: 139
        "3":
          label: for (item in items)
          log_filter_key: "ForLoopWithBodyHeaders|root:0|hdr:loop-processing:0|hdr:main-loop:0|loop:for-item-in-items:0"
          node_type: loop
          parent: "2"
          span:
            file: src/control_flow/testdata/ForLoopWithBodyHeaders.baml
            start: 144
            end: 327
        "4":
          label: Item Processing
          log_filter_key: "ForLoopWithBodyHeaders|root:0|hdr:loop-processing:0|hdr:main-loop:0|loop:for-item-in-items:0|hdr:item-processing:0"
          node_type: header
          parent: "3"
          span:
            file: src/control_flow/testdata/ForLoopWithBodyHeaders.baml
            start: 178
            end: 199
        "5":
          label: Accumulation
          log_filter_key: "ForLoopWithBodyHeaders|root:0|hdr:loop-processing:0|hdr:main-loop:0|loop:for-item-in-items:0|hdr:item-processing:0|hdr:accumulation:0"
          node_type: header
          parent: "4"
          span:
            file: src/control_flow/testdata/ForLoopWithBodyHeaders.baml
            start: 243
            end: 262
        "6":
          label: Final Result
          log_filter_key: "ForLoopWithBodyHeaders|root:0|hdr:loop-processing:0|hdr:final-result:1"
          node_type: header
          parent: "1"
          span:
            file: src/control_flow/testdata/ForLoopWithBodyHeaders.baml
            start: 333
            end: 350
      edges:
        "2":
          - "6"
    mermaid: "flowchart TD\nsubgraph n0[\"0: ForLoopWithBodyHeaders\"]\n  direction TB\n  subgraph n1[\"1: Loop Processing\"]\n    direction TB\n    subgraph n2[\"2: Main Loop\"]\n      direction TB\n      subgraph n3[\"3: Loop: for (item in items)\"]\n        direction TB\n        subgraph n4[\"4: Item Processing\"]\n          direction TB\n          n5[\"5: Accumulation\"]\n        end\n      end\n    end\n    n6[\"6: Final Result\"]\n    n2 --> n6\n  end\nend\n"
  pass2_hoist_branch_arms:
    label: Hoist branch arms
    expr:
      nodes:
        "0":
          label: ForLoopWithBodyHeaders
          log_filter_key: "ForLoopWithBodyHeaders|root:0"
          node_type: function
          parent: ~
          span:
            file: src/control_flow/testdata/ForLoopWithBodyHeaders.baml
            start: 0
            end: 363
        "1":
          label: Loop Processing
          log_filter_key: "ForLoopWithBodyHeaders|root:0|hdr:loop-processing:0"
          node_type: header
          parent: "0"
          span:
            file: src/control_flow/testdata/ForLoopWithBodyHeaders.baml
            start: 47
            end: 66
        "2":
          label: Main Loop
          log_filter_key: "ForLoopWithBodyHeaders|root:0|hdr:loop-processing:0|hdr:main-loop:0"
          node_type: header
          parent: "1"
          span:
            file: src/control_flow/testdata/ForLoopWithBodyHeaders.baml
            start: 125
            end: 139
        "3":
          label: for (item in items)
          log_filter_key: "ForLoopWithBodyHeaders|root:0|hdr:loop-processing:0|hdr:main-loop:0|loop:for-item-in-items:0"
          node_type: loop
          parent: "2"
          span:
            file: src/control_flow/testdata/ForLoopWithBodyHeaders.baml
            start: 144
            end: 327
        "4":
          label: Item Processing
          log_filter_key: "ForLoopWithBodyHeaders|root:0|hdr:loop-processing:0|hdr:main-loop:0|loop:for-item-in-items:0|hdr:item-processing:0"
          node_type: header
          parent: "3"
          span:
            file: src/control_flow/testdata/ForLoopWithBodyHeaders.baml
            start: 178
            end: 199
        "5":
          label: Accumulation
          log_filter_key: "ForLoopWithBodyHeaders|root:0|hdr:loop-processing:0|hdr:main-loop:0|loop:for-item-in-items:0|hdr:item-processing:0|hdr:accumulation:0"
          node_type: header
          parent: "4"
          span:
            file: src/control_flow/testdata/ForLoopWithBodyHeaders.baml
            start: 243
            end: 262
        "6":
          label: Final Result
          log_filter_key: "ForLoopWithBodyHeaders|root:0|hdr:loop-processing:0|hdr:final-result:1"
          node_type: header
          parent: "1"
          span:
            file: src/control_flow/testdata/ForLoopWithBodyHeaders.baml
            start: 333
            end: 350
      edges:
        "2":
          - "6"
    json:
      nodes:
        "0":
          label: ForLoopWithBodyHeaders
          log_filter_key: "ForLoopWithBodyHeaders|root:0"
          node_type: function
          parent: ~
          span:
            file: src/control_flow/testdata/ForLoopWithBodyHeaders.baml
            start: 0
            end: 363
        "1":
          label: Loop Processing
          log_filter_key: "ForLoopWithBodyHeaders|root:0|hdr:loop-processing:0"
          node_type: header
          parent: "0"
          span:
            file: src/control_flow/testdata/ForLoopWithBodyHeaders.baml
            start: 47
            end: 66
        "2":
          label: Main Loop
          log_filter_key: "ForLoopWithBodyHeaders|root:0|hdr:loop-processing:0|hdr:main-loop:0"
          node_type: header
          parent: "1"
          span:
            file: src/control_flow/testdata/ForLoopWithBodyHeaders.baml
            start: 125
            end: 139
        "3":
          label: for (item in items)
          log_filter_key: "ForLoopWithBodyHeaders|root:0|hdr:loop-processing:0|hdr:main-loop:0|loop:for-item-in-items:0"
          node_type: loop
          parent: "2"
          span:
            file: src/control_flow/testdata/ForLoopWithBodyHeaders.baml
            start: 144
            end: 327
        "4":
          label: Item Processing
          log_filter_key: "ForLoopWithBodyHeaders|root:0|hdr:loop-processing:0|hdr:main-loop:0|loop:for-item-in-items:0|hdr:item-processing:0"
          node_type: header
          parent: "3"
          span:
            file: src/control_flow/testdata/ForLoopWithBodyHeaders.baml
            start: 178
            end: 199
        "5":
          label: Accumulation
          log_filter_key: "ForLoopWithBodyHeaders|root:0|hdr:loop-processing:0|hdr:main-loop:0|loop:for-item-in-items:0|hdr:item-processing:0|hdr:accumulation:0"
          node_type: header
          parent: "4"
          span:
            file: src/control_flow/testdata/ForLoopWithBodyHeaders.baml
            start: 243
            end: 262
        "6":
          label: Final Result
          log_filter_key: "ForLoopWithBodyHeaders|root:0|hdr:loop-processing:0|hdr:final-result:1"
          node_type: header
          parent: "1"
          span:
            file: src/control_flow/testdata/ForLoopWithBodyHeaders.baml
            start: 333
            end: 350
      edges:
        "2":
          - "6"
    mermaid: "flowchart TD\nsubgraph n0[\"0: ForLoopWithBodyHeaders\"]\n  direction TB\n  subgraph n1[\"1: Loop Processing\"]\n    direction TB\n    subgraph n2[\"2: Main Loop\"]\n      direction TB\n      subgraph n3[\"3: Loop: for (item in items)\"]\n        direction TB\n        subgraph n4[\"4: Item Processing\"]\n          direction TB\n          n5[\"5: Accumulation\"]\n        end\n      end\n    end\n    n6[\"6: Final Result\"]\n    n2 --> n6\n  end\nend\n"
  pass3_flatten_scopes:
    label: Flatten branch arms & scopes
    expr:
      nodes:
        "0":
          label: ForLoopWithBodyHeaders
          log_filter_key: "ForLoopWithBodyHeaders|root:0"
          node_type: function
          parent: ~
          span:
            file: src/control_flow/testdata/ForLoopWithBodyHeaders.baml
            start: 0
            end: 363
        "1":
          label: Loop Processing
          log_filter_key: "ForLoopWithBodyHeaders|root:0|hdr:loop-processing:0"
          node_type: header
          parent: "0"
          span:
            file: src/control_flow/testdata/ForLoopWithBodyHeaders.baml
            start: 47
            end: 66
        "2":
          label: Main Loop
          log_filter_key: "ForLoopWithBodyHeaders|root:0|hdr:loop-processing:0|hdr:main-loop:0"
          node_type: header
          parent: "1"
          span:
            file: src/control_flow/testdata/ForLoopWithBodyHeaders.baml
            start: 125
            end: 139
        "3":
          label: for (item in items)
          log_filter_key: "ForLoopWithBodyHeaders|root:0|hdr:loop-processing:0|hdr:main-loop:0|loop:for-item-in-items:0"
          node_type: loop
          parent: "2"
          span:
            file: src/control_flow/testdata/ForLoopWithBodyHeaders.baml
            start: 144
            end: 327
        "4":
          label: Item Processing
          log_filter_key: "ForLoopWithBodyHeaders|root:0|hdr:loop-processing:0|hdr:main-loop:0|loop:for-item-in-items:0|hdr:item-processing:0"
          node_type: header
          parent: "3"
          span:
            file: src/control_flow/testdata/ForLoopWithBodyHeaders.baml
            start: 178
            end: 199
        "5":
          label: Accumulation
          log_filter_key: "ForLoopWithBodyHeaders|root:0|hdr:loop-processing:0|hdr:main-loop:0|loop:for-item-in-items:0|hdr:item-processing:0|hdr:accumulation:0"
          node_type: header
          parent: "4"
          span:
            file: src/control_flow/testdata/ForLoopWithBodyHeaders.baml
            start: 243
            end: 262
        "6":
          label: Final Result
          log_filter_key: "ForLoopWithBodyHeaders|root:0|hdr:loop-processing:0|hdr:final-result:1"
          node_type: header
          parent: "1"
          span:
            file: src/control_flow/testdata/ForLoopWithBodyHeaders.baml
            start: 333
            end: 350
      edges:
        "2":
          - "6"
    json:
      nodes:
        "0":
          label: ForLoopWithBodyHeaders
          log_filter_key: "ForLoopWithBodyHeaders|root:0"
          node_type: function
          parent: ~
          span:
            file: src/control_flow/testdata/ForLoopWithBodyHeaders.baml
            start: 0
            end: 363
        "1":
          label: Loop Processing
          log_filter_key: "ForLoopWithBodyHeaders|root:0|hdr:loop-processing:0"
          node_type: header
          parent: "0"
          span:
            file: src/control_flow/testdata/ForLoopWithBodyHeaders.baml
            start: 47
            end: 66
        "2":
          label: Main Loop
          log_filter_key: "ForLoopWithBodyHeaders|root:0|hdr:loop-processing:0|hdr:main-loop:0"
          node_type: header
          parent: "1"
          span:
            file: src/control_flow/testdata/ForLoopWithBodyHeaders.baml
            start: 125
            end: 139
        "3":
          label: for (item in items)
          log_filter_key: "ForLoopWithBodyHeaders|root:0|hdr:loop-processing:0|hdr:main-loop:0|loop:for-item-in-items:0"
          node_type: loop
          parent: "2"
          span:
            file: src/control_flow/testdata/ForLoopWithBodyHeaders.baml
            start: 144
            end: 327
        "4":
          label: Item Processing
          log_filter_key: "ForLoopWithBodyHeaders|root:0|hdr:loop-processing:0|hdr:main-loop:0|loop:for-item-in-items:0|hdr:item-processing:0"
          node_type: header
          parent: "3"
          span:
            file: src/control_flow/testdata/ForLoopWithBodyHeaders.baml
            start: 178
            end: 199
        "5":
          label: Accumulation
          log_filter_key: "ForLoopWithBodyHeaders|root:0|hdr:loop-processing:0|hdr:main-loop:0|loop:for-item-in-items:0|hdr:item-processing:0|hdr:accumulation:0"
          node_type: header
          parent: "4"
          span:
            file: src/control_flow/testdata/ForLoopWithBodyHeaders.baml
            start: 243
            end: 262
        "6":
          label: Final Result
          log_filter_key: "ForLoopWithBodyHeaders|root:0|hdr:loop-processing:0|hdr:final-result:1"
          node_type: header
          parent: "1"
          span:
            file: src/control_flow/testdata/ForLoopWithBodyHeaders.baml
            start: 333
            end: 350
      edges:
        "2":
          - "6"
    mermaid: "flowchart TD\nsubgraph n0[\"0: ForLoopWithBodyHeaders\"]\n  direction TB\n  subgraph n1[\"1: Loop Processing\"]\n    direction TB\n    subgraph n2[\"2: Main Loop\"]\n      direction TB\n      subgraph n3[\"3: Loop: for (item in items)\"]\n        direction TB\n        subgraph n4[\"4: Item Processing\"]\n          direction TB\n          n5[\"5: Accumulation\"]\n        end\n      end\n    end\n    n6[\"6: Final Result\"]\n    n2 --> n6\n  end\nend\n"
