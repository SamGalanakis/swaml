---
source: baml-runtime/src/control_flow/tests.rs
expression: snapshot_value
input_file: baml-runtime/src/control_flow/testdata/ProcessVideo.baml
---
hir: "Some(\n    Block {\n        statements: [\n            HeaderContextEnter(\n                HeaderContext {\n                    level: 1,\n                    title: \"Main Processing Pipeline\",\n                    span: Span {\n                        file: SourceFile { path: \"src/control_flow/testdata/ProcessVideo.baml\", contents: ... },\n                        start: 130,\n                        end: 158,\n                    },\n                },\n            ),\n            HeaderContextEnter(\n                HeaderContext {\n                    level: 2,\n                    title: \"Test\",\n                    span: Span {\n                        file: SourceFile { path: \"src/control_flow/testdata/ProcessVideo.baml\", contents: ... },\n                        start: 164,\n                        end: 173,\n                    },\n                },\n            ),\n            DeclareAndAssign {\n                name: \"computed_title\",\n                value: If {\n                    condition: UnaryOperation {\n                        operator: Not,\n                        expr: Identifier(\n                            \"title\",\n                            Span {\n                                file: SourceFile { path: \"src/control_flow/testdata/ProcessVideo.baml\", contents: ... },\n                                start: 204,\n                                end: 209,\n                            },\n                        ),\n                        span: Span {\n                            file: SourceFile { path: \"src/control_flow/testdata/ProcessVideo.baml\", contents: ... },\n                            start: 203,\n                            end: 209,\n                        },\n                    },\n                    if_branch: Block(\n                        Block {\n                            statements: [\n                                HeaderContextEnter(\n                                    HeaderContext {\n                                        level: 1,\n                                        title: \"Generate Title\",\n                                        span: Span {\n                                            file: SourceFile { path: \"src/control_flow/testdata/ProcessVideo.baml\", contents: ... },\n                                            start: 221,\n                                            end: 240,\n                                        },\n                                    },\n                                ),\n                            ],\n                            trailing_expr: Some(\n                                Call {\n                                    function: Identifier(\n                                        \"GenerateTitle\",\n                                        Span {\n                                            file: SourceFile { path: \"src/control_flow/testdata/ProcessVideo.baml\", contents: ... },\n                                            start: 249,\n                                            end: 262,\n                                        },\n                                    ),\n                                    type_args: [],\n                                    args: [\n                                        Identifier(\n                                            \"transcript\",\n                                            Span {\n                                                file: SourceFile { path: \"src/control_flow/testdata/ProcessVideo.baml\", contents: ... },\n                                                start: 263,\n                                                end: 273,\n                                            },\n                                        ),\n                                    ],\n                                    span: Span {\n                                        file: SourceFile { path: \"src/control_flow/testdata/ProcessVideo.baml\", contents: ... },\n                                        start: 249,\n                                        end: 274,\n                                    },\n                                },\n                            ),\n                        },\n                        Span {\n                            file: SourceFile { path: \"src/control_flow/testdata/ProcessVideo.baml\", contents: ... },\n                            start: 211,\n                            end: 280,\n                        },\n                    ),\n                    else_branch: Some(\n                        Block(\n                            Block {\n                                statements: [],\n                                trailing_expr: Some(\n                                    Identifier(\n                                        \"title\",\n                                        Span {\n                                            file: SourceFile { path: \"src/control_flow/testdata/ProcessVideo.baml\", contents: ... },\n                                            start: 296,\n                                            end: 301,\n                                        },\n                                    ),\n                                ),\n                            },\n                            Span {\n                                file: SourceFile { path: \"src/control_flow/testdata/ProcessVideo.baml\", contents: ... },\n                                start: 286,\n                                end: 307,\n                            },\n                        ),\n                    ),\n                    span: Span {\n                        file: SourceFile { path: \"src/control_flow/testdata/ProcessVideo.baml\", contents: ... },\n                        start: 199,\n                        end: 307,\n                    },\n                },\n                annotated_type: None,\n                watch: None,\n                span: Span {\n                    file: SourceFile { path: \"src/control_flow/testdata/ProcessVideo.baml\", contents: ... },\n                    start: 178,\n                    end: 309,\n                },\n            },\n            HeaderContextEnter(\n                HeaderContext {\n                    level: 2,\n                    title: \"Generate Summary\",\n                    span: Span {\n                        file: SourceFile { path: \"src/control_flow/testdata/ProcessVideo.baml\", contents: ... },\n                        start: 314,\n                        end: 335,\n                    },\n                },\n            ),\n            DeclareAndAssign {\n                name: \"summary\",\n                value: Call {\n                    function: Identifier(\n                        \"SummarizeVideo\",\n                        Span {\n                            file: SourceFile { path: \"src/control_flow/testdata/ProcessVideo.baml\", contents: ... },\n                            start: 354,\n                            end: 368,\n                        },\n                    ),\n                    type_args: [],\n                    args: [\n                        Identifier(\n                            \"transcript\",\n                            Span {\n                                file: SourceFile { path: \"src/control_flow/testdata/ProcessVideo.baml\", contents: ... },\n                                start: 369,\n                                end: 379,\n                            },\n                        ),\n                    ],\n                    span: Span {\n                        file: SourceFile { path: \"src/control_flow/testdata/ProcessVideo.baml\", contents: ... },\n                        start: 354,\n                        end: 380,\n                    },\n                },\n                annotated_type: None,\n                watch: None,\n                span: Span {\n                    file: SourceFile { path: \"src/control_flow/testdata/ProcessVideo.baml\", contents: ... },\n                    start: 340,\n                    end: 382,\n                },\n            },\n            HeaderContextEnter(\n                HeaderContext {\n                    level: 2,\n                    title: \"Create Final Output\",\n                    span: Span {\n                        file: SourceFile { path: \"src/control_flow/testdata/ProcessVideo.baml\", contents: ... },\n                        start: 387,\n                        end: 411,\n                    },\n                },\n            ),\n        ],\n        trailing_expr: Some(\n            BinaryOperation {\n                left: BinaryOperation {\n                    left: Identifier(\n                        \"computed_title\",\n                        Span {\n                            file: SourceFile { path: \"src/control_flow/testdata/ProcessVideo.baml\", contents: ... },\n                            start: 416,\n                            end: 430,\n                        },\n                    ),\n                    operator: Add,\n                    right: StringValue(\n                        \": \",\n                        Span {\n                            file: SourceFile { path: \"src/control_flow/testdata/ProcessVideo.baml\", contents: ... },\n                            start: 433,\n                            end: 437,\n                        },\n                    ),\n                    span: Span {\n                        file: SourceFile { path: \"src/control_flow/testdata/ProcessVideo.baml\", contents: ... },\n                        start: 416,\n                        end: 447,\n                    },\n                },\n                operator: Add,\n                right: Identifier(\n                    \"summary\",\n                    Span {\n                        file: SourceFile { path: \"src/control_flow/testdata/ProcessVideo.baml\", contents: ... },\n                        start: 440,\n                        end: 447,\n                    },\n                ),\n                span: Span {\n                    file: SourceFile { path: \"src/control_flow/testdata/ProcessVideo.baml\", contents: ... },\n                    start: 416,\n                    end: 447,\n                },\n            },\n        ),\n    },\n)"
expr:
  nodes:
    "0":
      label: ProcessVideo
      log_filter_key: "ProcessVideo|root:0"
      node_type: function
      parent: ~
      span:
        file: src/control_flow/testdata/ProcessVideo.baml
        start: 56
        end: 449
    "1":
      label: Main Processing Pipeline
      log_filter_key: "ProcessVideo|root:0|hdr:main-processing-pipeline:0"
      node_type: header
      parent: "0"
      span:
        file: src/control_flow/testdata/ProcessVideo.baml
        start: 130
        end: 158
    "2":
      label: Test
      log_filter_key: "ProcessVideo|root:0|hdr:main-processing-pipeline:0|hdr:test:0"
      node_type: header
      parent: "1"
      span:
        file: src/control_flow/testdata/ProcessVideo.baml
        start: 164
        end: 173
    "3":
      label: if (!title)
      log_filter_key: "ProcessVideo|root:0|hdr:main-processing-pipeline:0|hdr:test:0|bg:if-title:0"
      node_type: branch-group
      parent: "2"
      span:
        file: src/control_flow/testdata/ProcessVideo.baml
        start: 199
        end: 307
    "4":
      label: if (!title)
      log_filter_key: "ProcessVideo|root:0|hdr:main-processing-pipeline:0|hdr:test:0|bg:if-title:0|arm:if-title:0"
      node_type: branch-arm
      parent: "3"
      span:
        file: src/control_flow/testdata/ProcessVideo.baml
        start: 211
        end: 280
    "5":
      label: Generate Title
      log_filter_key: "ProcessVideo|root:0|hdr:main-processing-pipeline:0|hdr:test:0|bg:if-title:0|arm:if-title:0|hdr:generate-title:0"
      node_type: header
      parent: "4"
      span:
        file: src/control_flow/testdata/ProcessVideo.baml
        start: 221
        end: 240
    "6":
      label: else
      log_filter_key: "ProcessVideo|root:0|hdr:main-processing-pipeline:0|hdr:test:0|bg:if-title:0|arm:else:1"
      node_type: branch-arm
      parent: "3"
      span:
        file: src/control_flow/testdata/ProcessVideo.baml
        start: 286
        end: 307
    "7":
      label: Generate Summary
      log_filter_key: "ProcessVideo|root:0|hdr:main-processing-pipeline:0|hdr:generate-summary:1"
      node_type: header
      parent: "1"
      span:
        file: src/control_flow/testdata/ProcessVideo.baml
        start: 314
        end: 335
    "8":
      label: Create Final Output
      log_filter_key: "ProcessVideo|root:0|hdr:main-processing-pipeline:0|hdr:create-final-output:2"
      node_type: header
      parent: "1"
      span:
        file: src/control_flow/testdata/ProcessVideo.baml
        start: 387
        end: 411
  edges:
    "2":
      - "7"
    "7":
      - "8"
mermaid: "flowchart TD\nsubgraph n0[\"0: ProcessVideo\"]\n  direction TB\n  subgraph n1[\"1: Main Processing Pipeline\"]\n    direction TB\n    subgraph n2[\"2: Test\"]\n      direction TB\n      subgraph n3[\"3: BranchGroup: if (!title)\"]\n        direction TB\n        subgraph n4[\"4: BranchArm: if (!title)\"]\n          direction TB\n          n5[\"5: Generate Title\"]\n        end\n        n6[\"6: BranchArm: else\"]\n      end\n    end\n    n7[\"7: Generate Summary\"]\n    n8[\"8: Create Final Output\"]\n    n2 --> n7\n    n7 --> n8\n  end\nend\n"
flattening:
  pass1_remove_implicit:
    label: Remove implicit nodes
    expr:
      nodes:
        "0":
          label: ProcessVideo
          log_filter_key: "ProcessVideo|root:0"
          node_type: function
          parent: ~
          span:
            file: src/control_flow/testdata/ProcessVideo.baml
            start: 56
            end: 449
        "1":
          label: Main Processing Pipeline
          log_filter_key: "ProcessVideo|root:0|hdr:main-processing-pipeline:0"
          node_type: header
          parent: "0"
          span:
            file: src/control_flow/testdata/ProcessVideo.baml
            start: 130
            end: 158
        "2":
          label: Test
          log_filter_key: "ProcessVideo|root:0|hdr:main-processing-pipeline:0|hdr:test:0"
          node_type: header
          parent: "1"
          span:
            file: src/control_flow/testdata/ProcessVideo.baml
            start: 164
            end: 173
        "3":
          label: if (!title)
          log_filter_key: "ProcessVideo|root:0|hdr:main-processing-pipeline:0|hdr:test:0|bg:if-title:0"
          node_type: branch-group
          parent: "2"
          span:
            file: src/control_flow/testdata/ProcessVideo.baml
            start: 199
            end: 307
        "4":
          label: if (!title)
          log_filter_key: "ProcessVideo|root:0|hdr:main-processing-pipeline:0|hdr:test:0|bg:if-title:0|arm:if-title:0"
          node_type: branch-arm
          parent: "3"
          span:
            file: src/control_flow/testdata/ProcessVideo.baml
            start: 211
            end: 280
        "5":
          label: Generate Title
          log_filter_key: "ProcessVideo|root:0|hdr:main-processing-pipeline:0|hdr:test:0|bg:if-title:0|arm:if-title:0|hdr:generate-title:0"
          node_type: header
          parent: "4"
          span:
            file: src/control_flow/testdata/ProcessVideo.baml
            start: 221
            end: 240
        "6":
          label: else
          log_filter_key: "ProcessVideo|root:0|hdr:main-processing-pipeline:0|hdr:test:0|bg:if-title:0|arm:else:1"
          node_type: branch-arm
          parent: "3"
          span:
            file: src/control_flow/testdata/ProcessVideo.baml
            start: 286
            end: 307
        "7":
          label: Generate Summary
          log_filter_key: "ProcessVideo|root:0|hdr:main-processing-pipeline:0|hdr:generate-summary:1"
          node_type: header
          parent: "1"
          span:
            file: src/control_flow/testdata/ProcessVideo.baml
            start: 314
            end: 335
        "8":
          label: Create Final Output
          log_filter_key: "ProcessVideo|root:0|hdr:main-processing-pipeline:0|hdr:create-final-output:2"
          node_type: header
          parent: "1"
          span:
            file: src/control_flow/testdata/ProcessVideo.baml
            start: 387
            end: 411
      edges:
        "2":
          - "7"
        "7":
          - "8"
    json:
      nodes:
        "0":
          label: ProcessVideo
          log_filter_key: "ProcessVideo|root:0"
          node_type: function
          parent: ~
          span:
            file: src/control_flow/testdata/ProcessVideo.baml
            start: 56
            end: 449
        "1":
          label: Main Processing Pipeline
          log_filter_key: "ProcessVideo|root:0|hdr:main-processing-pipeline:0"
          node_type: header
          parent: "0"
          span:
            file: src/control_flow/testdata/ProcessVideo.baml
            start: 130
            end: 158
        "2":
          label: Test
          log_filter_key: "ProcessVideo|root:0|hdr:main-processing-pipeline:0|hdr:test:0"
          node_type: header
          parent: "1"
          span:
            file: src/control_flow/testdata/ProcessVideo.baml
            start: 164
            end: 173
        "3":
          label: if (!title)
          log_filter_key: "ProcessVideo|root:0|hdr:main-processing-pipeline:0|hdr:test:0|bg:if-title:0"
          node_type: branch-group
          parent: "2"
          span:
            file: src/control_flow/testdata/ProcessVideo.baml
            start: 199
            end: 307
        "4":
          label: if (!title)
          log_filter_key: "ProcessVideo|root:0|hdr:main-processing-pipeline:0|hdr:test:0|bg:if-title:0|arm:if-title:0"
          node_type: branch-arm
          parent: "3"
          span:
            file: src/control_flow/testdata/ProcessVideo.baml
            start: 211
            end: 280
        "5":
          label: Generate Title
          log_filter_key: "ProcessVideo|root:0|hdr:main-processing-pipeline:0|hdr:test:0|bg:if-title:0|arm:if-title:0|hdr:generate-title:0"
          node_type: header
          parent: "4"
          span:
            file: src/control_flow/testdata/ProcessVideo.baml
            start: 221
            end: 240
        "6":
          label: else
          log_filter_key: "ProcessVideo|root:0|hdr:main-processing-pipeline:0|hdr:test:0|bg:if-title:0|arm:else:1"
          node_type: branch-arm
          parent: "3"
          span:
            file: src/control_flow/testdata/ProcessVideo.baml
            start: 286
            end: 307
        "7":
          label: Generate Summary
          log_filter_key: "ProcessVideo|root:0|hdr:main-processing-pipeline:0|hdr:generate-summary:1"
          node_type: header
          parent: "1"
          span:
            file: src/control_flow/testdata/ProcessVideo.baml
            start: 314
            end: 335
        "8":
          label: Create Final Output
          log_filter_key: "ProcessVideo|root:0|hdr:main-processing-pipeline:0|hdr:create-final-output:2"
          node_type: header
          parent: "1"
          span:
            file: src/control_flow/testdata/ProcessVideo.baml
            start: 387
            end: 411
      edges:
        "2":
          - "7"
        "7":
          - "8"
    mermaid: "flowchart TD\nsubgraph n0[\"0: ProcessVideo\"]\n  direction TB\n  subgraph n1[\"1: Main Processing Pipeline\"]\n    direction TB\n    subgraph n2[\"2: Test\"]\n      direction TB\n      subgraph n3[\"3: BranchGroup: if (!title)\"]\n        direction TB\n        subgraph n4[\"4: BranchArm: if (!title)\"]\n          direction TB\n          n5[\"5: Generate Title\"]\n        end\n        n6[\"6: BranchArm: else\"]\n      end\n    end\n    n7[\"7: Generate Summary\"]\n    n8[\"8: Create Final Output\"]\n    n2 --> n7\n    n7 --> n8\n  end\nend\n"
  pass2_hoist_branch_arms:
    label: Hoist branch arms
    expr:
      nodes:
        "0":
          label: ProcessVideo
          log_filter_key: "ProcessVideo|root:0"
          node_type: function
          parent: ~
          span:
            file: src/control_flow/testdata/ProcessVideo.baml
            start: 56
            end: 449
        "1":
          label: Main Processing Pipeline
          log_filter_key: "ProcessVideo|root:0|hdr:main-processing-pipeline:0"
          node_type: header
          parent: "0"
          span:
            file: src/control_flow/testdata/ProcessVideo.baml
            start: 130
            end: 158
        "2":
          label: Test
          log_filter_key: "ProcessVideo|root:0|hdr:main-processing-pipeline:0|hdr:test:0"
          node_type: header
          parent: "1"
          span:
            file: src/control_flow/testdata/ProcessVideo.baml
            start: 164
            end: 173
        "3":
          label: if (!title)
          log_filter_key: "ProcessVideo|root:0|hdr:main-processing-pipeline:0|hdr:test:0|bg:if-title:0"
          node_type: branch-group
          parent: "2"
          span:
            file: src/control_flow/testdata/ProcessVideo.baml
            start: 199
            end: 307
        "4":
          label: if (!title)
          log_filter_key: "ProcessVideo|root:0|hdr:main-processing-pipeline:0|hdr:test:0|bg:if-title:0|arm:if-title:0"
          node_type: branch-arm
          parent: "2"
          span:
            file: src/control_flow/testdata/ProcessVideo.baml
            start: 211
            end: 280
        "5":
          label: Generate Title
          log_filter_key: "ProcessVideo|root:0|hdr:main-processing-pipeline:0|hdr:test:0|bg:if-title:0|arm:if-title:0|hdr:generate-title:0"
          node_type: header
          parent: "4"
          span:
            file: src/control_flow/testdata/ProcessVideo.baml
            start: 221
            end: 240
        "6":
          label: else
          log_filter_key: "ProcessVideo|root:0|hdr:main-processing-pipeline:0|hdr:test:0|bg:if-title:0|arm:else:1"
          node_type: branch-arm
          parent: "2"
          span:
            file: src/control_flow/testdata/ProcessVideo.baml
            start: 286
            end: 307
        "7":
          label: Generate Summary
          log_filter_key: "ProcessVideo|root:0|hdr:main-processing-pipeline:0|hdr:generate-summary:1"
          node_type: header
          parent: "1"
          span:
            file: src/control_flow/testdata/ProcessVideo.baml
            start: 314
            end: 335
        "8":
          label: Create Final Output
          log_filter_key: "ProcessVideo|root:0|hdr:main-processing-pipeline:0|hdr:create-final-output:2"
          node_type: header
          parent: "1"
          span:
            file: src/control_flow/testdata/ProcessVideo.baml
            start: 387
            end: 411
      edges:
        "2":
          - "7"
        "3":
          - "4"
          - "6"
        "7":
          - "8"
    json:
      nodes:
        "0":
          label: ProcessVideo
          log_filter_key: "ProcessVideo|root:0"
          node_type: function
          parent: ~
          span:
            file: src/control_flow/testdata/ProcessVideo.baml
            start: 56
            end: 449
        "1":
          label: Main Processing Pipeline
          log_filter_key: "ProcessVideo|root:0|hdr:main-processing-pipeline:0"
          node_type: header
          parent: "0"
          span:
            file: src/control_flow/testdata/ProcessVideo.baml
            start: 130
            end: 158
        "2":
          label: Test
          log_filter_key: "ProcessVideo|root:0|hdr:main-processing-pipeline:0|hdr:test:0"
          node_type: header
          parent: "1"
          span:
            file: src/control_flow/testdata/ProcessVideo.baml
            start: 164
            end: 173
        "3":
          label: if (!title)
          log_filter_key: "ProcessVideo|root:0|hdr:main-processing-pipeline:0|hdr:test:0|bg:if-title:0"
          node_type: branch-group
          parent: "2"
          span:
            file: src/control_flow/testdata/ProcessVideo.baml
            start: 199
            end: 307
        "4":
          label: if (!title)
          log_filter_key: "ProcessVideo|root:0|hdr:main-processing-pipeline:0|hdr:test:0|bg:if-title:0|arm:if-title:0"
          node_type: branch-arm
          parent: "2"
          span:
            file: src/control_flow/testdata/ProcessVideo.baml
            start: 211
            end: 280
        "5":
          label: Generate Title
          log_filter_key: "ProcessVideo|root:0|hdr:main-processing-pipeline:0|hdr:test:0|bg:if-title:0|arm:if-title:0|hdr:generate-title:0"
          node_type: header
          parent: "4"
          span:
            file: src/control_flow/testdata/ProcessVideo.baml
            start: 221
            end: 240
        "6":
          label: else
          log_filter_key: "ProcessVideo|root:0|hdr:main-processing-pipeline:0|hdr:test:0|bg:if-title:0|arm:else:1"
          node_type: branch-arm
          parent: "2"
          span:
            file: src/control_flow/testdata/ProcessVideo.baml
            start: 286
            end: 307
        "7":
          label: Generate Summary
          log_filter_key: "ProcessVideo|root:0|hdr:main-processing-pipeline:0|hdr:generate-summary:1"
          node_type: header
          parent: "1"
          span:
            file: src/control_flow/testdata/ProcessVideo.baml
            start: 314
            end: 335
        "8":
          label: Create Final Output
          log_filter_key: "ProcessVideo|root:0|hdr:main-processing-pipeline:0|hdr:create-final-output:2"
          node_type: header
          parent: "1"
          span:
            file: src/control_flow/testdata/ProcessVideo.baml
            start: 387
            end: 411
      edges:
        "2":
          - "7"
        "3":
          - "4"
          - "6"
        "7":
          - "8"
    mermaid: "flowchart TD\nsubgraph n0[\"0: ProcessVideo\"]\n  direction TB\n  subgraph n1[\"1: Main Processing Pipeline\"]\n    direction TB\n    subgraph n2[\"2: Test\"]\n      direction TB\n      n3[\"3: BranchGroup: if (!title)\"]\n      subgraph n4[\"4: BranchArm: if (!title)\"]\n        direction TB\n        n5[\"5: Generate Title\"]\n      end\n      n6[\"6: BranchArm: else\"]\n      n3 --> n4\n      n3 --> n6\n    end\n    n7[\"7: Generate Summary\"]\n    n8[\"8: Create Final Output\"]\n    n2 --> n7\n    n7 --> n8\n  end\nend\n"
  pass3_flatten_scopes:
    label: Flatten branch arms & scopes
    expr:
      nodes:
        "0":
          label: ProcessVideo
          log_filter_key: "ProcessVideo|root:0"
          node_type: function
          parent: ~
          span:
            file: src/control_flow/testdata/ProcessVideo.baml
            start: 56
            end: 449
        "1":
          label: Main Processing Pipeline
          log_filter_key: "ProcessVideo|root:0|hdr:main-processing-pipeline:0"
          node_type: header
          parent: "0"
          span:
            file: src/control_flow/testdata/ProcessVideo.baml
            start: 130
            end: 158
        "2":
          label: Test
          log_filter_key: "ProcessVideo|root:0|hdr:main-processing-pipeline:0|hdr:test:0"
          node_type: header
          parent: "1"
          span:
            file: src/control_flow/testdata/ProcessVideo.baml
            start: 164
            end: 173
        "3":
          label: if (!title)
          log_filter_key: "ProcessVideo|root:0|hdr:main-processing-pipeline:0|hdr:test:0|bg:if-title:0"
          node_type: branch-group
          parent: "2"
          span:
            file: src/control_flow/testdata/ProcessVideo.baml
            start: 199
            end: 307
        "5":
          label: Generate Title
          log_filter_key: "ProcessVideo|root:0|hdr:main-processing-pipeline:0|hdr:test:0|bg:if-title:0|arm:if-title:0|hdr:generate-title:0"
          node_type: header
          parent: "2"
          span:
            file: src/control_flow/testdata/ProcessVideo.baml
            start: 221
            end: 240
        "6":
          label: else
          log_filter_key: "ProcessVideo|root:0|hdr:main-processing-pipeline:0|hdr:test:0|bg:if-title:0|arm:else:1"
          node_type: branch-arm
          parent: "2"
          span:
            file: src/control_flow/testdata/ProcessVideo.baml
            start: 286
            end: 307
        "7":
          label: Generate Summary
          log_filter_key: "ProcessVideo|root:0|hdr:main-processing-pipeline:0|hdr:generate-summary:1"
          node_type: header
          parent: "1"
          span:
            file: src/control_flow/testdata/ProcessVideo.baml
            start: 314
            end: 335
        "8":
          label: Create Final Output
          log_filter_key: "ProcessVideo|root:0|hdr:main-processing-pipeline:0|hdr:create-final-output:2"
          node_type: header
          parent: "1"
          span:
            file: src/control_flow/testdata/ProcessVideo.baml
            start: 387
            end: 411
      edges:
        "2":
          - "7"
        "3":
          - "5"
          - "6"
        "7":
          - "8"
    json:
      nodes:
        "0":
          label: ProcessVideo
          log_filter_key: "ProcessVideo|root:0"
          node_type: function
          parent: ~
          span:
            file: src/control_flow/testdata/ProcessVideo.baml
            start: 56
            end: 449
        "1":
          label: Main Processing Pipeline
          log_filter_key: "ProcessVideo|root:0|hdr:main-processing-pipeline:0"
          node_type: header
          parent: "0"
          span:
            file: src/control_flow/testdata/ProcessVideo.baml
            start: 130
            end: 158
        "2":
          label: Test
          log_filter_key: "ProcessVideo|root:0|hdr:main-processing-pipeline:0|hdr:test:0"
          node_type: header
          parent: "1"
          span:
            file: src/control_flow/testdata/ProcessVideo.baml
            start: 164
            end: 173
        "3":
          label: if (!title)
          log_filter_key: "ProcessVideo|root:0|hdr:main-processing-pipeline:0|hdr:test:0|bg:if-title:0"
          node_type: branch-group
          parent: "2"
          span:
            file: src/control_flow/testdata/ProcessVideo.baml
            start: 199
            end: 307
        "5":
          label: Generate Title
          log_filter_key: "ProcessVideo|root:0|hdr:main-processing-pipeline:0|hdr:test:0|bg:if-title:0|arm:if-title:0|hdr:generate-title:0"
          node_type: header
          parent: "2"
          span:
            file: src/control_flow/testdata/ProcessVideo.baml
            start: 221
            end: 240
        "6":
          label: else
          log_filter_key: "ProcessVideo|root:0|hdr:main-processing-pipeline:0|hdr:test:0|bg:if-title:0|arm:else:1"
          node_type: branch-arm
          parent: "2"
          span:
            file: src/control_flow/testdata/ProcessVideo.baml
            start: 286
            end: 307
        "7":
          label: Generate Summary
          log_filter_key: "ProcessVideo|root:0|hdr:main-processing-pipeline:0|hdr:generate-summary:1"
          node_type: header
          parent: "1"
          span:
            file: src/control_flow/testdata/ProcessVideo.baml
            start: 314
            end: 335
        "8":
          label: Create Final Output
          log_filter_key: "ProcessVideo|root:0|hdr:main-processing-pipeline:0|hdr:create-final-output:2"
          node_type: header
          parent: "1"
          span:
            file: src/control_flow/testdata/ProcessVideo.baml
            start: 387
            end: 411
      edges:
        "2":
          - "7"
        "3":
          - "5"
          - "6"
        "7":
          - "8"
    mermaid: "flowchart TD\nsubgraph n0[\"0: ProcessVideo\"]\n  direction TB\n  subgraph n1[\"1: Main Processing Pipeline\"]\n    direction TB\n    subgraph n2[\"2: Test\"]\n      direction TB\n      n3[\"3: BranchGroup: if (!title)\"]\n      n4[\"5: Generate Title\"]\n      n5[\"6: BranchArm: else\"]\n      n3 --> n4\n      n3 --> n5\n    end\n    n6[\"7: Generate Summary\"]\n    n7[\"8: Create Final Output\"]\n    n2 --> n6\n    n6 --> n7\n  end\nend\n"
