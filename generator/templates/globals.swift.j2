// Generated by BAML - do not edit
// swift-format-ignore-file

import Foundation
import SWAML

/// Global BAML client instance
/// Configure with environment variables or call `configureBaml()` before use
public enum Baml {
    private static var _client: BamlAsyncClient?
    private static var _runtime: BamlRuntime?

    /// The shared async client instance
    public static var client: BamlAsyncClient {
        get async {
            if _client == nil {
                await configure()
            }
            return _client!
        }
    }

    /// Configure the BAML runtime with default settings from environment
    public static func configure() async {
        let registry = ClientRegistry()

        // Register clients from generated config
{% for config in client_configs %}
        await registry.register(
            name: "{{ config.name }}",
            provider: {{ config|provider_init }},
            model: "{{ config.model }}",
            isDefault: {% if loop.first %}true{% else %}false{% endif %}
        )
{% endfor %}

        _runtime = BamlRuntime(clientRegistry: registry)
        _client = BamlAsyncClient(runtime: _runtime!)
    }

    /// Configure with a custom runtime
    public static func configure(runtime: BamlRuntime) {
        _runtime = runtime
        _client = BamlAsyncClient(runtime: runtime)
    }

    /// Configure with a custom client registry
    public static func configure(clientRegistry: ClientRegistry) {
        _runtime = BamlRuntime(clientRegistry: clientRegistry)
        _client = BamlAsyncClient(runtime: _runtime!)
    }

    /// Reset the global client (useful for testing)
    public static func reset() {
        _client = nil
        _runtime = nil
    }
}

// MARK: - Environment Configuration

extension Baml {
    /// Get an API key from environment variables
    public static func envApiKey(_ name: String) -> String? {
        ProcessInfo.processInfo.environment[name]
    }

    /// Get a required API key, throwing if not found
    public static func requireEnvApiKey(_ name: String) throws -> String {
        guard let key = envApiKey(name) else {
            throw BamlError.configurationError("Missing required environment variable: \(name)")
        }
        return key
    }
}
