{% if docstring.is_some() %}
/// {{ docstring.as_ref().unwrap() }}
{% endif %}
public enum {{ name }}: Codable, Sendable, Equatable {
{% for variant in variants %}
{% if variant.docstring.is_some() %}
    /// {{ variant.docstring.as_ref().unwrap() }}
{% endif %}
    case {{ variant.name }}({{ variant.type_string() }})
{% endfor %}

    // MARK: - Codable

    private enum CodingKeys: String, CodingKey {
        case type = "_type"
        case value
    }

    public init(from decoder: Decoder) throws {
        // Try single-value decoding first (for simple types)
        if let container = try? decoder.singleValueContainer() {
{% for variant in variants %}
{% if variant.variant_type.is_primitive() %}
            if let value = try? container.decode({{ variant.type_string() }}.self) {
                self = .{{ variant.name }}(value)
                return
            }
{% endif %}
{% endfor %}
        }

        // Try keyed decoding with type discriminator
        let container = try decoder.container(keyedBy: CodingKeys.self)
        if let typeName = try? container.decode(String.self, forKey: .type) {
            switch typeName {
{% for variant in variants %}
            case "{{ variant.name }}":
                let value = try container.decode({{ variant.type_string() }}.self, forKey: .value)
                self = .{{ variant.name }}(value)
                return
{% endfor %}
            default:
                break
            }
        }

        // Try each type in order
{% for variant in variants %}
        if let value = try? {{ variant.type_string() }}(from: decoder) {
            self = .{{ variant.name }}(value)
            return
        }
{% endfor %}

        throw DecodingError.typeMismatch(
            {{ name }}.self,
            DecodingError.Context(
                codingPath: decoder.codingPath,
                debugDescription: "Unable to decode {{ name }} from any known type"
            )
        )
    }

    public func encode(to encoder: Encoder) throws {
        var container = encoder.container(keyedBy: CodingKeys.self)

        switch self {
{% for variant in variants %}
        case .{{ variant.name }}(let value):
            try container.encode("{{ variant.name }}", forKey: .type)
            try container.encode(value, forKey: .value)
{% endfor %}
        }
    }

    // MARK: - Value Access

{% for variant in variants %}
    /// Returns the {{ variant.name }} value if this is a .{{ variant.name }} case, nil otherwise.
    public var {{ variant.name }}Value: {{ variant.type_string() }}? {
        if case .{{ variant.name }}(let value) = self {
            return value
        }
        return nil
    }

    /// Returns true if this is a .{{ variant.name }} case.
    public var is{{ variant.name|capitalize }}: Bool {
        if case .{{ variant.name }} = self {
            return true
        }
        return false
    }

{% endfor %}
}
